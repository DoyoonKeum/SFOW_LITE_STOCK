<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="raw">

<resultMap type="rawDTO" id="rawDTO">
        <result property="companyCode" column="company_code"/>
        <result property="itemCode" column="item_code"/>
        <result property="itemName" column="item_name"/>
        <result property="itemNo" column="item_no"/>
        <result property="itemType" column="item_type"/>
        <result property="itemSpecification" column="item_specification"/>
        <result property="itemStockUnit" column="item_stock_unit"/>
        <result property="clientCode" column="client_code"/>
        <result property="clientName" column="client_name"/>
        <result property="warehouseCode" column="warehouseCode"/>
        <result property="warehouseName" column="warehouseName"/>
        <result property="memo" column="memo"/>
        <result property="useyn" column="useyn"/>
        <result property="createdate" column="createdate"/>
        <result property="updatedate" column="updatedate"/>
        <result property="itemCategory" column="itemCategory"/>
    </resultMap> 

	<select id="rawList" resultType="rawDTO">
		<![CDATA[
		select i.company_code as companyCode, i.item_code as itemCode,i.item_name as itemName,i.item_no as itemNo,i.item_type as itemType,i.item_specification as itemSpecification,i.item_stock_unit as itemStockUnit,c.client_name as clientName,w.warehouse_code as warehouseCode,w.warehouse_name as warehouseName,i.memo,i.useyn,i.createdate,i.updatedate
			from ma_item i, ma_client_company c, wh w 
			where item_category='원자재' AND (i.useyn='Y' or i.useyn is null)
		order by i.item_code 
		]]>	
	</select>

	<select id="rawListSearch" resultMap="rawDTO" parameterType="rawDTO">
		<![CDATA[
		select i.company_code as companyCode, i.item_code as itemCode,i.item_name as itemName,i.item_no as itemNo,i.item_type as itemType,i.item_specification as itemSpecification,i.item_stock_unit as itemStockUnit,c.client_name as clientName,w.warehouse_code as warehouseCode,w.warehouse_name as warehouseName,i.memo,i.useyn,i.createdate,i.updatedate
			from ma_item i, ma_client_company c, wh w
			where  item_category='원자재'
						 AND (i.useyn='Y' or i.useyn is null)
						 AND COALESCE(item_code, '') LIKE CONCAT('%', #{itemCode}, '%')
						 AND COALESCE(item_name, '') LIKE CONCAT('%', #{itemName}, '%')
						 AND COALESCE(item_no, '') LIKE CONCAT('%', #{itemNo}, '%')
						 AND COALESCE(item_specification, '') LIKE CONCAT('%', #{itemSpecification}, '%') 
		order by i.item_code 
		]]>	
	</select>

	<insert id="insertRaw" parameterType="rawDTO">

		INSERT INTO ma_item (company_code,item_name, item_no, item_type, item_specification,itemStockUnit,client_name, warehouse_code,warehouse_name, memo,useyn,createdate,item_category) 
		values ('1',#{itemName}, #{itemNo}, #{itemType}, #{itemSpecification}, #{itemStockUnit},거래처명,'창고코드','창고명',#{memo}, #{useyn},now(),'원자재')
	</insert>
	
	<update id="updateRaw" parameterType="rawDTO">
		update ma_item
		set item_name=#{itemName}, item_no=#{itemNo}, item_type=#{itemType} ,item_specification=#{itemSpecification},item_stock_unit=#{itemStockUnit},buy_price=#{buyPrice}, sales_price=#{salesPrice}, lotsize=#{lotSize}, memo=#{memo},useyn=#{useyn} 
		where item_code=#{itemCode}
	</update>

	<update id="useUpdate" parameterType="String">
		<![CDATA[
			update ma_item
			set useyn='N'
			where item_code=#{itemCode}
		]]>
	</update>
	
	<!-- Modal -->
	
	<!-- Client modal   -->
	<select id="getModalClient" resultType="Map">
      <![CDATA[
         SELECT client_code as clientCode,client_name as clientName
		 FROM ma_client_company
      ]]>
   </select>
   
   	<!-- Type modal   -->
	<select id="getModalType" resultType="Map">
	<![CDATA[
 	SELECT item_category as itemCategory, item_type as itemType
	FROM ma_itemtype
	WHERE item_category='원자재'
	 ]]>
   </select>
   
   	<!-- Specification modal   -->
	<select id="getModalSpecification" resultType="Map">
	 <![CDATA[
	 	SELECT item_specification as itemSpecification
		FROM ma_item_specification
	 ]]>
   	</select>
   	
   	<!-- StockUnit modal   -->
	<select id="getModalStockUnit" resultType="Map">
	 <![CDATA[
	 	SELECT item_Stock_Unit as itemStockUnit
		FROM ma_item_stockunit
	 ]]>
   	</select>
   

</mapper>  